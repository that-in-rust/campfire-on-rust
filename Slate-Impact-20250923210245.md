# Slate Snapshot — 2025-09-23 21:02:45

Objective
- Capture a creative, parseltongue-driven snapshot:
  - Parseltongue assessment (benefits, limits, where it helps us)
  - “Impact radar” (uses/calls) for core components
  - Route inventory (grounded in src/main.rs)
  - Practical workflows we can automate next

Context recap
- Current ISG snapshot: 54 files → 541 nodes, 894 edges (HTML viz: parseltongue_workspace/analysis_20250923193618/architecture.html)
- Handlers: auth, pages, rooms, messages, search, websocket, push, sounds, bot
- Services: auth, room, message, search, push, bot, connection
- Data: SQLite + FTS5; sessions; rooms/users/members/messages

Parseltongue: my assessment
- Strengths (direct value to us)
  - Speed: ingest and HTML graph generation are near-instant at this repo size; queries feel “interactive.”
  - Orientation: generate-context gives quick, structured snapshots of traits/types/functions to anchor mental models.
  - Impact queries: “uses” and “calls” are perfect for scoping change risk and locating entry points.
  - Visualization: the HTML graph is fast to regenerate and useful for team onboarding and reviews.
- Limits to keep in mind
  - Exact entity names matter; generic names won’t match (use debug --graph + grep to find right nouns).
  - Macro/generics visibility is limited in details; favor usage patterns and concrete impls over generic templates.
  - Some queries (e.g., find-cycles) may be too coarse or sparse for tiny projects; fall back to context + uses/calls.
- When it benefits us most
  - PR review / refactors: quantify risk (user count, callers) before edits.
  - Debugging: trace entry points and data flows without jumping files manually.
  - Documentation: automated architecture.html + concise contexts for key modules.
- Bottom line
  - It is worth integrating into daily flow. It delivers fast, actionable signal with minimal setup overhead.

Impact radar (parseltongue quick counts)
- Note: “uses” approximates direct references; “calls” shows invocations of functions.
- AppState: uses=N/A (see analysis folder contexts)
- AuthService: uses=N/A
- RoomService: uses=N/A
- MessageService: uses=N/A
- SearchService: uses=N/A
- PushNotificationServiceImpl: uses=N/A
- BotServiceImpl: uses=N/A
- ConnectionManagerImpl: uses=N/A
- create_message_with_deduplication: callers=N/A

Interpretation hints
- High “uses” → central dependency; changes need broader testing.
- Many callers → treat as entry point; evolve with care, keep stable contracts.
- For N/A entries above: run the impact script again when code shifts, or target additional entities by exact names discovered via `debug --graph | grep -i <partial>`.

Route inventory (from src/main.rs)
- Pages & assets
  - GET  /                     → pages::serve_root_page
  - GET  /chat                 → assets::serve_chat_interface
  - GET  /login                → pages::serve_login_page
  - GET  /demo                 → assets::serve_demo_page
  - GET  /manifest.json        → assets::serve_manifest
  - GET  /static/*path         → assets::serve_static_asset
- Demo API
  - GET  /api/demo/status      → pages::demo_status
  - POST /api/demo/initialize  → pages::initialize_demo
- Health & metrics
  - GET  /health               → health::health_check
  - GET  /health/ready         → health::readiness_check
  - GET  /health/live          → health::liveness_check
  - GET  <metrics endpoint>    → metrics::metrics_endpoint (if enabled)
  - GET  /metrics/summary      → metrics::metrics_summary (if enabled)
- WebSocket
  - GET  /ws                   → websocket::websocket_handler (if enabled)
- Core API
  - POST /api/auth/login       → auth::login
  - POST /api/auth/logout      → auth::logout
  - GET  /api/users/me         → users::get_current_user
  - GET  /api/rooms            → rooms::get_rooms
  - POST /api/rooms            → rooms::create_room
  - GET  /api/rooms/:id        → rooms::get_room
  - POST /api/rooms/:id/members  → rooms::add_room_member
  - GET  /api/rooms/:id/messages → messages::get_messages
  - POST /api/rooms/:id/messages → messages::create_message
- Search (if enabled)
  - GET  /api/search           → search::search_messages
- Sounds (if enabled)
  - GET  /api/sounds                         → sounds::list_sounds
  - GET  /api/sounds/:sound_name             → sounds::get_sound
  - GET  /api/sounds/:sound_name/info        → sounds::get_sound_info
- Push notifications (if enabled)
  - POST   /api/push/subscriptions           → push::create_push_subscription
  - DELETE /api/push/subscriptions/:id       → push::delete_push_subscription
  - GET    /api/push/preferences             → push::get_notification_preferences
  - PUT    /api/push/preferences             → push::update_notification_preferences
  - GET    /api/push/vapid-key               → push::get_vapid_public_key
  - POST   /api/push/test                    → push::send_test_notification (debug only)
- Bot API (if enabled)
  - GET/POST /api/bots                       → bot::list_bots / create_bot
  - GET/PUT/DELETE /api/bots/:id             → bot::get_bot / update_bot / delete_bot
  - POST /rooms/:room_id/bot/:bot_key/messages → bot::create_bot_message

User journey sketch (concise)
- Regular mode (no demo)
  1) Login (GET /login → POST /api/auth/login), session cookie set
  2) Rooms sidebar (GET /api/rooms), create or open room
  3) Room view (GET /api/rooms/:id + GET /api/rooms/:id/messages)
  4) Real-time (GET /ws), compose messages (POST /api/rooms/:id/messages)
  5) Search (GET /api/search), optional push setup if configured
- Demo mode
  1) Root/login show demo variants; seed via /api/demo/initialize as needed
  2) Explore pre-seeded rooms/messages; all core flows function identically

How to exploit parseltongue next
- A) Risk snapshot before refactors (5 min)
  - For a target (e.g., MessageService):
    - `query uses MessageService` → user count
    - `query calls create_message_with_deduplication` → caller count
    - `generate-context MessageService --format human` → dependencies
- B) Debugging trace (6–10 min)
  - `query calls <function>` + `generate-context <function>`
  - Follow edges in architecture.html for hotspots (state, I/O)
- C) PR helper checklist
  - Add “impact counts” to PRs; if >20 users or >10 callers, require extra tests
  - Attach updated architecture.html for large changes

Appendix: current artifacts
- Visualization: parseltongue_workspace/analysis_20250923193618/architecture.html
- Contexts: parseltongue_workspace/analysis_20250923193618/context_*.{txt,json}
- Prior snapshots: Slate20250923192202.md, Slate20250923194000.md, Slate20250923195030.md, Slate20250923210108.md